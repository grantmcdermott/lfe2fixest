---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# lfe2fixest

<!-- badges: start -->
<!-- badges: end -->

The goal of **lfe2fixest** is to take R scripts that rely on the `felm()` function 
from the [**lfe**](https://github.com/sgaure/lfe) package and convert 
them to the `feols()` equivalent from [**fixest**](https://github.com/lrberge/fixest) 
package.

## Installation

Install the package from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("grantmcdermott/lfe2fixest")
```
## Example

Let's create a (deliberately messy) **lfe**-based R script.

```{r lfe_script}
lfe_string =
  "library(lfe)

  	aq = airquality
  	names(aq) = c('y', 'x1', 'x2', 'x3', 'mnth', 'dy')

   mod1 = felm(y ~ x1 + x2, aq)

   mod2 = felm(y ~ x1 + x2 |
     dy |
     0 |
     mnth, aq)

   mod3 = felm(y ~ x1 + x2 |
     0 |
     0 |
     dy + mnth,
     aq)

   mod4 = felm(y ~ 1 |
     dy |
     (x1 ~ x3) |
     mnth,
     weights = aq$x2,
     cmethod = 'reghdfe',
     exactDOF = TRUE,
     data = aq
     )"
writeLines(lfe_string, 'lfe_script.R')
```

We can convert it to something that is **fixest** friendly using the package's
main (only!) function, `lfe2fixest::lfe2fixest()`.

```{r fixest_script}
library(lfe2fixest)

## If no output file provided, it will print to screen
lfe2fixest('lfe_script.R')

## Looks good, let's write it to disk by supplying the output file
lfe2fixest('lfe_script.R', 'fixest_script.R')
```

Note that the `lfe2fixest()` is a pure conversion function. It never actually
runs anything from the input or output scripts. That being, said, here's a quick 
comparison of resulting regressions (i.e. what we get if we do actually run the 
scripts) using the excellent **modelsummary** package.

```{r comparison}
library(modelsummary)

## First the lfe version
source('lfe_script.R')
msummary(list(mod1, mod2, mod3, mod4), gof_omit = 'Psuedo|Log|IC',
				 output = 'markdown')

## Then the fixest conversion
source('fixest_script.R')
msummary(list(mod1, mod2, mod3, mod4), gof_omit = 'Psuedo|Log|IC',
				 output = 'markdown')
```

Finally, clean up.

```{r cleanup}
file.remove(c('lfe_script.R', 'fixest_script.R'))
```

## Caveats

This package was thrown together pretty quickly. Current limitations include:

- `lfe2fixest()` assumes that users provide a dataset in their model calls (i.e. 
regressions with global variables are not supported). 
- `lfe2fixest()` does not yet handle multiple IV regression. 
- Comments inside the `felm()` model call are liable to mess things up. 

I'll try to address these as time allows. PRs are most welcome.

